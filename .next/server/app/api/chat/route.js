"use strict";(()=>{var e={id:744,ids:[744]};e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55736:(e,t,n)=>{n.r(t),n.d(t,{originalPathname:()=>q,patchFetch:()=>X,requestAsyncStorage:()=>U,routeModule:()=>F,serverHooks:()=>$,staticGenerationAsyncStorage:()=>j});var s={};n.r(s),n.d(s,{POST:()=>B});var o,r,i,a,c,d,u=n(49303),l=n(88716),h=n(60670);!function(e){e.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",e.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",e.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",e.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT"}(o||(o={})),function(e){e.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE"}(r||(r={})),function(e){e.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",e.NEGLIGIBLE="NEGLIGIBLE",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH"}(i||(i={})),function(e){e.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",e.SAFETY="SAFETY",e.OTHER="OTHER"}(a||(a={})),function(e){e.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",e.STOP="STOP",e.MAX_TOKENS="MAX_TOKENS",e.SAFETY="SAFETY",e.RECITATION="RECITATION",e.OTHER="OTHER"}(c||(c={})),function(e){e.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",e.RETRIEVAL_QUERY="RETRIEVAL_QUERY",e.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",e.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",e.CLASSIFICATION="CLASSIFICATION",e.CLUSTERING="CLUSTERING"}(d||(d={}));class p extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}}class f extends p{constructor(e,t){super(e),this.response=t}}const E="0.2.1",g="genai-js";var m;!function(e){e.GENERATE_CONTENT="generateContent",e.STREAM_GENERATE_CONTENT="streamGenerateContent",e.COUNT_TOKENS="countTokens",e.EMBED_CONTENT="embedContent",e.BATCH_EMBED_CONTENTS="batchEmbedContents"}(m||(m={}));class y{constructor(e,t,n,s){this.model=e,this.task=t,this.apiKey=n,this.stream=s}toString(){let e=`https://generativelanguage.googleapis.com/v1/${this.model}:${this.task}`;return this.stream&&(e+="?alt=sse"),e}}async function A(e,t,n){let s;try{if(s=await fetch(e.toString(),Object.assign(Object.assign({},function(e){const t={};if((null===e||void 0===e?void 0:e.timeout)>=0){const n=new AbortController,s=n.signal;setTimeout((()=>n.abort()),e.timeout),t.signal=s}return t}(n)),{method:"POST",headers:{"Content-Type":"application/json","x-goog-api-client":`${g}/${E}`,"x-goog-api-key":e.apiKey},body:t})),!s.ok){let e="";try{const t=await s.json();e=t.error.message,t.error.details&&(e+=` ${JSON.stringify(t.error.details)}`)}catch(o){}throw new Error(`[${s.status} ${s.statusText}] ${e}`)}}catch(o){const t=new p(`Error fetching from ${e.toString()}: ${o.message}`);throw t.stack=o.stack,t}return s}function O(e){return e.text=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),_(e.candidates[0]))throw new f(`${S(e)}`,e);return function(e){var t,n,s,o;return(null===(o=null===(s=null===(n=null===(t=e.candidates)||void 0===t?void 0:t[0].content)||void 0===n?void 0:n.parts)||void 0===s?void 0:s[0])||void 0===o?void 0:o.text)?e.candidates[0].content.parts[0].text:""}(e)}if(e.promptFeedback)throw new f(`Text not available. ${S(e)}`,e);return""},e}const T=[c.RECITATION,c.SAFETY];function _(e){return!!e.finishReason&&T.includes(e.finishReason)}function S(e){var t,n,s;let o="";if(e.candidates&&0!==e.candidates.length||!e.promptFeedback){if(null===(s=e.candidates)||void 0===s?void 0:s[0]){const t=e.candidates[0];_(t)&&(o+=`Candidate was blocked due to ${t.finishReason}`,t.finishMessage&&(o+=`: ${t.finishMessage}`))}}else o+="Response was blocked",(null===(t=e.promptFeedback)||void 0===t?void 0:t.blockReason)&&(o+=` due to ${e.promptFeedback.blockReason}`),(null===(n=e.promptFeedback)||void 0===n?void 0:n.blockReasonMessage)&&(o+=`: ${e.promptFeedback.blockReasonMessage}`);return o}function R(e){return this instanceof R?(this.v=e,this):new R(e)}function C(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s,o=n.apply(e,t||[]),r=[];return s={},i("next"),i("throw"),i("return"),s[Symbol.asyncIterator]=function(){return this},s;function i(e){o[e]&&(s[e]=function(t){return new Promise((function(n,s){r.push([e,t,n,s])>1||a(e,t)}))})}function a(e,t){try{(n=o[e](t)).value instanceof R?Promise.resolve(n.value.v).then(c,d):u(r[0][2],n)}catch(s){u(r[0][3],s)}var n}function c(e){a("next",e)}function d(e){a("throw",e)}function u(e,t){e(t),r.shift(),r.length&&a(r[0][0],r[0][1])}}"function"===typeof SuppressedError&&SuppressedError;const I=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function N(e){const t=function(e){const t=e.getReader();return new ReadableStream({start(e){let n="";return s();function s(){return t.read().then((({value:t,done:o})=>{if(o)return n.trim()?void e.error(new p("Failed to parse stream")):void e.close();n+=t;let r,i=n.match(I);for(;i;){try{r=JSON.parse(i[1])}catch(a){return void e.error(new p(`Error parsing JSON response: "${i[1]}"`))}e.enqueue(r),n=n.substring(i[0].length),i=n.match(I)}return s()}))}}})}(e.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0}))),[n,s]=t.tee();return{stream:w(n),response:v(s)}}async function v(e){const t=[],n=e.getReader();for(;;){const{done:e,value:s}=await n.read();if(e)return O(M(t));t.push(s)}}function w(e){return C(this,arguments,(function*(){const t=e.getReader();for(;;){const{value:e,done:n}=yield R(t.read());if(n)break;yield yield R(O(e))}}))}function M(e){const t=e[e.length-1],n={promptFeedback:null===t||void 0===t?void 0:t.promptFeedback};for(const s of e)if(s.candidates)for(const e of s.candidates){const t=e.index;if(n.candidates||(n.candidates=[]),n.candidates[t]||(n.candidates[t]={index:e.index}),n.candidates[t].citationMetadata=e.citationMetadata,n.candidates[t].finishReason=e.finishReason,n.candidates[t].finishMessage=e.finishMessage,n.candidates[t].safetyRatings=e.safetyRatings,e.content&&e.content.parts){n.candidates[t].content||(n.candidates[t].content={role:e.content.role||"user",parts:[{text:""}]});for(const s of e.content.parts)s.text&&(n.candidates[t].content.parts[0].text+=s.text)}}return n}async function b(e,t,n,s){const o=new y(t,m.STREAM_GENERATE_CONTENT,e,!0);return N(await A(o,JSON.stringify(n),s))}async function H(e,t,n,s){const o=new y(t,m.GENERATE_CONTENT,e,!1),r=await A(o,JSON.stringify(n),s);return{response:O(await r.json())}}function P(e,t){let n=[];if("string"===typeof e)n=[{text:e}];else for(const s of e)"string"===typeof s?n.push({text:s}):n.push(s);return{role:t,parts:n}}function L(e){if(e.contents)return e;return{contents:[P(e,"user")]}}const x="SILENT_ERROR";class G{constructor(e,t,n,s){this.model=t,this.params=n,this.requestOptions=s,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,(null===n||void 0===n?void 0:n.history)&&(this._history=n.history.map((e=>{if(!e.role)throw new Error("Missing role for history item: "+JSON.stringify(e));return P(e.parts,e.role)})))}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e){var t,n;await this._sendPromise;const s=P(e,"user"),o={safetySettings:null===(t=this.params)||void 0===t?void 0:t.safetySettings,generationConfig:null===(n=this.params)||void 0===n?void 0:n.generationConfig,contents:[...this._history,s]};let r;return this._sendPromise=this._sendPromise.then((()=>H(this._apiKey,this.model,o,this.requestOptions))).then((e=>{var t;if(e.response.candidates&&e.response.candidates.length>0){this._history.push(s);const n=Object.assign({parts:[],role:"model"},null===(t=e.response.candidates)||void 0===t?void 0:t[0].content);this._history.push(n)}else{const t=S(e.response);t&&console.warn(`sendMessage() was unsuccessful. ${t}. Inspect response object for details.`)}r=e})),await this._sendPromise,r}async sendMessageStream(e){var t,n;await this._sendPromise;const s=P(e,"user"),o={safetySettings:null===(t=this.params)||void 0===t?void 0:t.safetySettings,generationConfig:null===(n=this.params)||void 0===n?void 0:n.generationConfig,contents:[...this._history,s]},r=b(this._apiKey,this.model,o,this.requestOptions);return this._sendPromise=this._sendPromise.then((()=>r)).catch((e=>{throw new Error(x)})).then((e=>e.response)).then((e=>{if(e.candidates&&e.candidates.length>0){this._history.push(s);const t=Object.assign({},e.candidates[0].content);t.role||(t.role="model"),this._history.push(t)}else{const t=S(e);t&&console.warn(`sendMessageStream() was unsuccessful. ${t}. Inspect response object for details.`)}})).catch((e=>{e.message!==x&&console.error(e)})),r}}class Y{constructor(e,t,n){this.apiKey=e,t.model.includes("/")?this.model=t.model:this.model=`models/${t.model}`,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[],this.requestOptions=n||{}}async generateContent(e){const t=L(e);return H(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings},t),this.requestOptions)}async generateContentStream(e){const t=L(e);return b(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings},t),this.requestOptions)}startChat(e){return new G(this.apiKey,this.model,e,this.requestOptions)}async countTokens(e){const t=L(e);return async function(e,t,n,s){const o=new y(t,m.COUNT_TOKENS,e,!1);return(await A(o,JSON.stringify(Object.assign(Object.assign({},n),{model:t})),s)).json()}(this.apiKey,this.model,t)}async embedContent(e){const t=function(e){if("string"===typeof e||Array.isArray(e))return{content:P(e,"user")};return e}(e);return async function(e,t,n,s){const o=new y(t,m.EMBED_CONTENT,e,!1);return(await A(o,JSON.stringify(n),s)).json()}(this.apiKey,this.model,t)}async batchEmbedContents(e){return async function(e,t,n,s){const o=new y(t,m.BATCH_EMBED_CONTENTS,e,!1),r=n.requests.map((e=>Object.assign(Object.assign({},e),{model:t})));return(await A(o,JSON.stringify({requests:r}),s)).json()}(this.apiKey,this.model,e,this.requestOptions)}}const D="AIzaSyAOfSMe2MHp-1hYIAQdHDRFTvLkwhaoDKk";const K=new class{constructor(e){this.apiKey=e}getGenerativeModel(e,t){if(!e.model)throw new p("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new Y(this.apiKey,e,t)}}(D),k='IMPORTANT: You MUST act as MAX, BY1\'s AI consultant. NEVER reveal you are Gemini or any other AI. You are MAX, period.\n\nCore Identity:\n- Name: MAX\n- Role: BY1\'s AI consultant\n- Purpose: Guide users to fill out our contact form for detailed solutions\n\nStrict Guidelines:\n1. ALWAYS maintain the MAX identity - NEVER break character\n2. Keep responses under 3 sentences\n3. NEVER provide detailed solutions\n4. ALWAYS guide users to fill out the contact form\n\nResponse Template:\n1. "Hi, I\'m MAX from BY1." (first message only)\n2. Brief acknowledgment of their need\n3. "Please fill out our contact form above, and our team will provide a detailed solution tailored to your needs."\n\nExample Responses:\n"Hi, I\'m MAX from BY1. I understand you\'re looking to improve your social media presence. Please fill out our contact form above, and our team will provide a detailed solution tailored to your needs."\n\n"I see you\'re interested in process automation. Our team has extensive experience in this area - fill out the contact form above, and we\'ll create a custom plan for your business."\n\nRemember: You are MAX. Stay in character. Keep it brief. Guide to contact form.';async function B(e){try{console.log("Environment Variables:",process.env);const t=await e.json(),{messages:n}=t;if(!n||!Array.isArray(n))return new Response(JSON.stringify({success:!1,message:"Invalid request format"}),{status:400,headers:{"Content-Type":"application/json"}});if(!n.every((e=>e&&"object"===typeof e&&("user"===e.role||"assistant"===e.role)&&"string"===typeof e.content)))return new Response(JSON.stringify({success:!1,message:"Invalid message format"}),{status:400,headers:{"Content-Type":"application/json"}});const s=await async function(e){try{const t=K.getGenerativeModel({model:"gemini-pro",generationConfig:{temperature:.7,maxOutputTokens:1024}}),n=e[e.length-1];if(1===e.length){const e=await t.generateContent([{text:k},{text:`User: ${n.content}`}]);return{success:!0,message:(await e.response).text().trim()}}const s=t.startChat();await s.sendMessage(k);const o=e.filter((e=>"user"===e.role)),r=e.filter((e=>"assistant"===e.role));for(let e=0;e<o.length-1;e++)await s.sendMessage(o[e].content),r[e]&&await s.sendMessage(r[e].content);const i=await s.sendMessage(n.content);return{success:!0,message:(await i.response).text().trim()}}catch(t){return console.error("Error in generateChatResponse:",t.message),{success:!1,message:t.message||"I apologize, but I encountered a technical issue. Please try again in a moment."}}}(n);return new Response(JSON.stringify(s),{status:s.success?200:500,headers:{"Content-Type":"application/json"}})}catch(t){return console.error("Chat API error:",t),new Response(JSON.stringify({success:!1,message:t.message||"Internal server error"}),{status:500,headers:{"Content-Type":"application/json"}})}}const F=new u.AppRouteRouteModule({definition:{kind:l.x.APP_ROUTE,page:"/api/chat/route",pathname:"/api/chat",filename:"route",bundlePath:"app/api/chat/route"},resolvedPagePath:"G:\\Websites\\1-new_design\\Gen4\\by1-local\\app\\api\\chat\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:U,staticGenerationAsyncStorage:j,serverHooks:$}=F,q="/api/chat/route";function X(){return(0,h.patchFetch)({serverHooks:$,staticGenerationAsyncStorage:j})}},49303:(e,t,n)=>{e.exports=n(30517)}};var t=require("../../../webpack-runtime.js");t.C(e);var n=t.X(0,[948],(()=>{return e=55736,t(t.s=e);var e}));module.exports=n})();